<app-page-header [title]="isEdit() ? 'تعديل مرتجع' : 'تسجيل مرتجع'" />

<div class="card" style="max-width:520px">
  @if (loadingParts()) {
    <div class="spinner-overlay"><div class="spinner"></div></div>
  } @else {
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label class="form-label">القطعة <span class="required">*</span></label>
        <select
          class="form-control"
          [class.is-invalid]="form.controls.sparePartId.invalid && form.controls.sparePartId.touched"
          formControlName="sparePartId"
        >
          <option value="">-- اختر قطعة غيار --</option>
          @for (part of parts(); track part._id) {
            <option [value]="part._id">{{ part.name }}</option>
          }
        </select>
        @if (form.controls.sparePartId.invalid && form.controls.sparePartId.touched) {
          <p class="form-error">يجب اختيار قطعة</p>
        }
      </div>

      <div class="form-group">
        <label class="form-label">الكمية المرتجعة <span class="required">*</span></label>
        <input
          class="form-control"
          [class.is-invalid]="form.controls.quantityReturned.invalid && form.controls.quantityReturned.touched"
          type="number"
          formControlName="quantityReturned"
          min="1"
          placeholder="1"
        />
        @if (form.controls.quantityReturned.invalid && form.controls.quantityReturned.touched) {
          <p class="form-error">الكمية يجب أن تكون 1 على الأقل</p>
        }
      </div>

      <div class="form-group">
        <label class="form-label">السبب (اختياري)</label>
        <textarea
          class="form-control"
          formControlName="reason"
          placeholder="مثال: قطعة تالفة، خطأ في الطلب..."
          rows="3"
        ></textarea>
      </div>

      <div class="flex gap-2">
        <button type="submit" class="btn btn-primary" [disabled]="loading()">
          @if (loading()) { جارٍ الحفظ... } @else { {{ isEdit() ? 'حفظ التعديلات' : 'تسجيل المرتجع' }} }
        </button>
        <button type="button" class="btn btn-ghost" (click)="goBack()">إلغاء</button>
      </div>
    </form>
  }
</div>
